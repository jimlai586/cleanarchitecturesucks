<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>When ChatGPT tried to save you</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">When ChatGPT tried to save you</h1>
</header>
<section data-field="subtitle" class="p-summary">
Or things you didn’t cover with 100% code coverage
</section>
<section data-field="body" class="e-content">
<section name="67f1" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="516b" id="516b" class="graf graf--h3 graf--leading graf--title">When ChatGPT tried to save you</h3><p name="5152" id="5152" class="graf graf--p graf-after--h3">Or things you didn’t cover with 100% code coverage</p><figure name="6e22" id="6e22" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*vxp_4qPki7U8yWSS-DO6RA.jpeg" data-width="540" data-height="404" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*vxp_4qPki7U8yWSS-DO6RA.jpeg"><figcaption class="imageCaption">I know now why you cry, it’s the dumb shit people write</figcaption></figure><h4 name="2c43" id="2c43" class="graf graf--h4 graf-after--figure">Ah shit, here we go again</h4><p name="469c" id="469c" class="graf graf--p graf-after--h4">I was trying to learn something from <a href="https://medium.com/better-programming/swift-unit-testing-fatal-errors-420ed4cb1100" data-href="https://medium.com/better-programming/swift-unit-testing-fatal-errors-420ed4cb1100" class="markup--anchor markup--p-anchor" target="_blank">Swift: Unit Testing Fatal Errors</a>.</p><p name="f598" id="f598" class="graf graf--p graf-after--p">Besides usual singleton abuse, this caught my eyes:</p><blockquote name="36ee" id="36ee" class="graf graf--blockquote graf-after--p">So I decided to ask…</blockquote><blockquote name="d517" id="d517" class="graf graf--blockquote graf-after--blockquote">ChatGPT</blockquote><blockquote name="e922" id="e922" class="graf graf--blockquote graf-after--blockquote">ChatGPT started blathering on about <code class="markup--code markup--blockquote-code">XCTAssertThrows</code> and <code class="markup--code markup--blockquote-code">XCTAssertNoThrow</code>, which, as I’m sure you know, are about catching and testing thrown <em class="markup--em markup--blockquote-em">exceptions</em>. Not fatal errors.</blockquote><blockquote name="8575" id="8575" class="graf graf--blockquote graf-after--blockquote">When corrected on this matter, it then informed me that I should try something like <code class="markup--code markup--blockquote-code">fatalError = { didTriggerFatalError = true }</code>, which doesn’t compile since you can’t assign a closure to a function.</blockquote><p name="2180" id="2180" class="graf graf--p graf-after--blockquote">Some context: basically he wanted a customized <code class="markup--code markup--p-code">fatalError</code> so it won’t crash during test, but will crash in debug build, but not crash in release build.</p><p name="3dbe" id="3dbe" class="graf graf--p graf-after--p">So ChatGPT gave him a few pointers:</p><p name="c0d1" id="c0d1" class="graf graf--p graf-after--p"><em class="markup--em markup--p-em">(foolish human!)</em></p><ol class="postList"><li name="9656" id="9656" class="graf graf--li graf-after--p">throw error</li><li name="e145" id="e145" class="graf graf--li graf-after--li">use flag</li><li name="b484" id="b484" class="graf graf--li graf-after--li">use closure (customized function as variable)</li></ol><p name="0269" id="0269" class="graf graf--p graf-after--li">He dismissed ChatGPT because it didn’t answer his question. He wanted to use <code class="markup--code markup--p-code">fatalError</code> .</p><p name="5682" id="5682" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">But wait, ChatGPT is actually right!</strong></p><p name="2d31" id="2d31" class="graf graf--p graf-after--p">You should not use <code class="markup--code markup--p-code">fatalError</code> in release build, otherwise what’s the point of error handling? If anything goes sideways, crash it?</p><p name="828d" id="828d" class="graf graf--p graf-after--p">Which implies, the piece of code he wants to test, is not in release build.</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="c22d" id="c22d" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">#if</span> <span class="hljs-type">DEBUG</span><br /><span class="hljs-keyword">let</span> typeComponents <span class="hljs-operator">=</span> <span class="hljs-type">String</span>(describing: <span class="hljs-type">T</span>.<span class="hljs-keyword">self</span>).components(separatedBy: <span class="hljs-type">CharacterSet</span>(charactersIn: <span class="hljs-string">&quot;&lt;&gt;&quot;</span>))<br /><span class="hljs-keyword">let</span> typeName <span class="hljs-operator">=</span> typeComponents.count <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span> <span class="hljs-operator">?</span> typeComponents[<span class="hljs-number">1</span>] : typeComponents[<span class="hljs-number">0</span>]<br /><span class="hljs-keyword">let</span> typeIndex <span class="hljs-operator">=</span> dependencyChain.firstIndex(where: { <span class="hljs-variable">$0</span> <span class="hljs-operator">==</span> typeName })<br />dependencyChain.append(typeName)<br /><span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> index <span class="hljs-operator">=</span> typeIndex {<br />    <span class="hljs-keyword">let</span> message <span class="hljs-operator">=</span> <span class="hljs-string">&quot;circular dependency chain - <span class="hljs-subst">\(dependencyChain[index<span class="hljs-operator">...</span>].joined(separator: <span class="hljs-string">&quot; &gt; &quot;</span>))</span>&quot;</span><br />    <span class="hljs-built_in">fatalError</span>(message)<br />}<br /><span class="hljs-keyword">#endif</span><br /><br /><span class="hljs-comment">// don&#x27;t have this in release?</span></span></pre><p name="eeee" id="eeee" class="graf graf--p graf-after--pre">That piece of code happens to be checking <em class="markup--em markup--p-em">circular dependency</em>.</p><p name="36a7" id="36a7" class="graf graf--p graf-after--p">Which means, <strong class="markup--strong markup--p-strong">with 100% code coverage</strong>, including a <strong class="markup--strong markup--p-strong">rigorous </strong>test on <em class="markup--em markup--p-em">circular dependency</em>, that check is <strong class="markup--strong markup--p-strong">NOT shipped in release build.</strong></p><p name="4cce" id="4cce" class="graf graf--p graf-after--p">What’s the point of 100% code coverage then? To show that he is a TDD titan? If anything, this kind of mistake shows that he is not.</p><p name="ef94" id="ef94" class="graf graf--p graf-after--p">To test this in release build, first it needs to be refactored. How? You ask.</p><h4 name="28e9" id="28e9" class="graf graf--h4 graf-after--p">You forgot to say please</h4><p name="19a1" id="19a1" class="graf graf--p graf-after--h4">Just kidding. For anyone not a contributor in <em class="markup--em markup--p-em">better programming</em>, you already know it.</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="521f" id="521f" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> index <span class="hljs-operator">=</span> <span class="hljs-keyword">try?</span> circularCheck(<span class="hljs-operator">...</span>) <span class="hljs-keyword">else</span> { <span class="hljs-comment">// use optional, but can throwable</span><br />  <span class="hljs-keyword">#if</span> <span class="hljs-type">DEBUG</span><br />    <span class="hljs-built_in">fatalError</span>(msg)<br />  <span class="hljs-keyword">#else</span><br />    logging(<span class="hljs-operator">...</span>)<br />    errorHandling(<span class="hljs-operator">...</span>) <span class="hljs-comment">// may throw</span><br />  <span class="hljs-keyword">#endif</span><br />}<br /><span class="hljs-comment">// normal operation</span></span></pre><p name="e214" id="e214" class="graf graf--p graf-after--pre">This is a run-of-the-mills error handling structure, nothing special.</p><p name="a406" id="a406" class="graf graf--p graf-after--p">So when you are testing release build, you can test <code class="markup--code markup--p-code">throws</code> , or verify logging.</p><p name="a84e" id="a84e" class="graf graf--p graf-after--p">The only mistery here is why didn’t he do it? Instead he chose to bang his head against the wall and tried to override / customize <code class="markup--code markup--p-code">fatalError</code> .</p><blockquote name="2e3c" id="2e3c" class="graf graf--blockquote graf-after--p">ChatGPT started <strong class="markup--strong markup--blockquote-strong">blathering </strong>on about <code class="markup--code markup--blockquote-code"><em class="markup--em markup--blockquote-em">XCTAssertThrows</em></code> and <code class="markup--code markup--blockquote-code"><em class="markup--em markup--blockquote-em">XCTAssertNoThrow</em></code>, which, as I’m sure you know, <strong class="markup--strong markup--blockquote-strong">are about catching and testing thrown <em class="markup--em markup--blockquote-em">exceptions</em>. Not fatal errors.</strong></blockquote><p name="6848" id="6848" class="graf graf--p graf-after--blockquote">Because fatal errors have to be downgraded to exceptions in release build, and you are supposed to have an error handling structure anyway.</p><p name="9575" id="9575" class="graf graf--p graf-after--p">While ChatGPT might not get details right, it at least points you a direction, which is <code class="markup--code markup--p-code">throw</code> , followed by <code class="markup--code markup--p-code">do-try-catch</code> , i.e.; error handling.</p><p name="6b6c" id="6b6c" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Where is error handling in a 100% code coverage library?</strong></p><blockquote name="fd3f" id="fd3f" class="graf graf--blockquote graf-after--p">I wrote an earlier article on the <a href="https://betterprogramming.pub/swift-unit-testing-factory-40043b361f55" data-href="https://betterprogramming.pub/swift-unit-testing-factory-40043b361f55" class="markup--anchor markup--blockquote-anchor" rel="noopener ugc nofollow noopener" target="_blank">importance of unit testing in a library</a> and I still believe that it’s a best practice. And doubly so when that library is a <strong class="markup--strong markup--blockquote-strong">critical piece of code</strong> on which an entire application depends.</blockquote><p name="46e6" id="46e6" class="graf graf--p graf-after--blockquote">Oh, he meant unit testing something that won’t be in release build, and did not provide error handling for a critical piece of code that will crash in <strong class="markup--strong markup--p-strong">runtime </strong>despite of the claims of <strong class="markup--strong markup--p-strong">compile-time safety.</strong></p><blockquote name="d3c4" id="d3c4" class="graf graf--blockquote graf-after--p">The library in question is <a href="https://github.com/hmlongco/Factory" data-href="https://github.com/hmlongco/Factory" class="markup--anchor markup--blockquote-anchor" rel="noopener ugc nofollow noopener" target="_blank">Factory</a>, <strong class="markup--strong markup--blockquote-strong">a compile-time safe</strong> dependency injection system, and a successor to Resolver.</blockquote><p name="3514" id="3514" class="graf graf--p graf-after--blockquote">What even is compile-time safe? Can Swift be compile-time unsafe?</p><p name="8f1b" id="8f1b" class="graf graf--p graf-after--p">Isn’t <strong class="markup--strong markup--p-strong">runtime-safe</strong> what a user really needs for a library like this?</p><p name="c28c" id="c28c" class="graf graf--p graf-after--p">Some context here. This library is the second generation of a singleton “management” library, with stars and acclaims and a dozen articles going through the dev process written by one of top technical writers on this platform in a prestige sub “<em class="markup--em markup--p-em">better programming</em>”.</p><p name="93f8" id="93f8" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">So why is ChatGPT right, and he isn’t?</strong></p><p name="2e7c" id="2e7c" class="graf graf--p graf-after--p">You can argue that he didn’t think that far, or it’s not about best practice in unit test anyway. It’s about what he found in a <strong class="markup--strong markup--p-strong">JOURNEY</strong>.</p><p name="aef1" id="aef1" class="graf graf--p graf-after--p">I think the reason is that he can’t afford it. He needed to maintain the appearance of a lightweight library, optional unwrap or try-catch in every invocation kills it. He probably couldn’t use it as property wrapper either.</p><p name="e673" id="e673" class="graf graf--p graf-after--p">With <code class="markup--code markup--p-code">throw</code> , the test may look like this:</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="4b84" id="4b84" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">testCircularDependencyFailure</span>() {<br />    <span class="hljs-keyword">do</span> {<br />      <span class="hljs-keyword">let</span> <span class="hljs-keyword">_</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-type">Container</span>.recursiveA()<br />    } <span class="hljs-keyword">catch</span> {<br />      <span class="hljs-comment">// can assert success even when it throws </span><br />    }<br />}</span></pre><p name="a093" id="a093" class="graf graf--p graf-after--pre">Do I need a <strong class="markup--strong markup--p-strong">JOURNEY </strong>and over a year to finally achive 100% code coverage with this? No.</p><p name="436f" id="436f" class="graf graf--p graf-after--p">To be fair, we are assuming we could use try-catch. What if we can’t for whatever reason? Ah shit, do we need a <strong class="markup--strong markup--p-strong">JOURNEY </strong>too?</p><h4 name="077b" id="077b" class="graf graf--h4 graf-after--p">Dead? Terminated.</h4><figure name="fbc1" id="fbc1" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*ikVZm5JOByZlMM3oALmZdA.jpeg" data-width="500" data-height="852" src="https://cdn-images-1.medium.com/max/800/1*ikVZm5JOByZlMM3oALmZdA.jpeg"></figure><p name="8dff" id="8dff" class="graf graf--p graf-after--figure">Recall that he wanted a <code class="markup--code markup--p-code">fatalError</code> that will crash in debug, but won’t crash in test.</p><p name="2a06" id="2a06" class="graf graf--p graf-after--p">So, a custom error function that calls <code class="markup--code markup--p-code">fatalError</code> on condition. E.g.;</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="9dc1" id="9dc1" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">customError</span>() {<br />  <span class="hljs-keyword">#if</span> <span class="hljs-type">DEBUG</span><br />    <span class="hljs-built_in">fatalError</span>()<br />  <span class="hljs-keyword">#else</span> <br />    log()<br />  <span class="hljs-keyword">#endif</span><br />}<br /><span class="hljs-comment">// assume you run test in release build</span><br /><br /></span></pre><p name="d553" id="d553" class="graf graf--p graf-after--pre">We’ve reached the end of our <strong class="markup--strong markup--p-strong">JOURNEY</strong>. Thank you and remember to clap and subscribe… Wait! It can’t be this easy, right?</p><blockquote name="7897" id="7897" class="graf graf--blockquote graf-after--p">This is a modification of the StackOverflow answer provided by <strong class="markup--strong markup--blockquote-strong">Andrew Hershberger and Mikhail Yaskou</strong>.<strong class="markup--strong markup--blockquote-strong"> The highest rated answer </strong>on the page was the original “<strong class="markup--strong markup--blockquote-strong">unreachable</strong>” code shown above, which left an <strong class="markup--strong markup--blockquote-strong">abandoned thread spinning</strong> during the tests.</blockquote><p name="ae1c" id="ae1c" class="graf graf--p graf-after--blockquote">OMG. Andrew? Mikhail? They are here?</p><p name="0709" id="0709" class="graf graf--p graf-after--p">Unreachable? Abandoned thread spinning? Highest rated answer?</p><p name="09b8" id="09b8" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">They fking suck.</strong></p><p name="f788" id="f788" class="graf graf--p graf-after--p">Stackoverflow, like this platform, is 80% full of shit. Because there are way more shity devs than good devs.</p><p name="8c9c" id="8c9c" class="graf graf--p graf-after--p">But for the fun of it, let’s hear what ChatGPT has to say.</p><blockquote name="186b" id="186b" class="graf graf--blockquote graf-after--p">When corrected on this matter, it then informed me that I should try something like <code class="markup--code markup--blockquote-code">fatalError = { didTriggerFatalError = true }</code>, which doesn’t compile since you can’t assign a closure to a function.</blockquote><p name="6a0e" id="6a0e" class="graf graf--p graf-after--blockquote">Again, it may get details wrong. But the direction it shows here is that you should try some kind of flag or custom function.</p><p name="f2ae" id="f2ae" class="graf graf--p graf-after--p">It is actually more cleaver than he thinks. As we’ll compare later, it’s a better solution than his.</p><p name="a18a" id="a18a" class="graf graf--p graf-after--p">ChatGPT makes <code class="markup--code markup--p-code">fatalError</code> a closure to meet the requirement of function call <code class="markup--code markup--p-code">fatalError()</code> . But what it does is a customized flag assignment, which you can check in test. E.g.;</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="1143" id="1143" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">testCircularDependency</span>() {<br />  <span class="hljs-keyword">let</span> <span class="hljs-keyword">_</span> <span class="hljs-operator">=</span> <span class="hljs-type">Container</span>.recursiveA()<br />  <span class="hljs-built_in">assert</span>(<span class="hljs-type">Container</span>.didTriggerFatalError <span class="hljs-operator">==</span> <span class="hljs-literal">true</span>)<br />}</span></pre><p name="e378" id="e378" class="graf graf--p graf-after--pre">You can attach a property observer to error flag to trigger error handling.</p><p name="5626" id="5626" class="graf graf--p graf-after--p">It chose to use closure so it’s not hard-coded to a specific flag assignment. Quite impressive if you ask me.</p><p name="c2d5" id="c2d5" class="graf graf--p graf-after--p">Does ChatGPT bother to override / swizzle built-in <code class="markup--code markup--p-code">fatalError</code> ? No. It provides basic, regular, run-of-the-mills suggestions.</p><p name="74bf" id="74bf" class="graf graf--p graf-after--p">In other words, Andrew and Mikhail are the first two iOS devs who bite the dust in the fight against the machine. Congradulations.</p><p name="3fea" id="3fea" class="graf graf--p graf-after--p">I bet you are wondering now, so how does a top 1000 technical writer on this platform stand against ChatGPT? Let’s find out.</p><h4 name="1c8b" id="1c8b" class="graf graf--h4 graf-after--p">Hasta la vista</h4><figure name="fe31" id="fe31" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*sjQZBFed7BZ6suWxHfatSQ.jpeg" data-width="460" data-height="277" src="https://cdn-images-1.medium.com/max/800/1*sjQZBFed7BZ6suWxHfatSQ.jpeg"><figcaption class="imageCaption">ChatGPT as iOS developer</figcaption></figure><blockquote name="fc10" id="fc10" class="graf graf--blockquote graf-after--figure">That was my eureka moment. I could reduce all of the required in-library code down to one single line.</blockquote><blockquote name="bca9" id="bca9" class="graf graf--blockquote graf-after--blockquote">internal var triggerFatalError = Swift.fatalError</blockquote><p name="c603" id="c603" class="graf graf--p graf-after--blockquote">And this <strong class="markup--strong markup--p-strong">tiny </strong>little helper function:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="ffc1" id="ffc1" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">extension</span> <span class="hljs-title class_">XCTestCase</span> {<br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">expectFatalError</span>(<span class="hljs-params">expectedMessage</span>: <span class="hljs-type">String</span>, <span class="hljs-params">testcase</span>: <span class="hljs-keyword">@escaping</span> () -&gt; <span class="hljs-type">Void</span>) {<br />        <span class="hljs-keyword">let</span> expectation <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.expectation(description: <span class="hljs-string">&quot;expectingFatalError&quot;</span>)<br />        <span class="hljs-keyword">var</span> assertionMessage: <span class="hljs-type">String</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span><br /><br />        triggerFatalError <span class="hljs-operator">=</span> { (message, <span class="hljs-keyword">_</span>, <span class="hljs-keyword">_</span>) <span class="hljs-keyword">in</span><br />            assertionMessage <span class="hljs-operator">=</span> message()<br />            <span class="hljs-type">DispatchQueue</span>.main.async {<br />                expectation.fulfill()<br />            }<br />            <span class="hljs-type">Thread</span>.exit()<br />            <span class="hljs-type">Swift</span>.fatalError(<span class="hljs-string">&quot;will never be executed since thread exits&quot;</span>)<br />        }<br /><br />        <span class="hljs-type">Thread</span>(block: testcase).start()<br /><br />        waitForExpectations(timeout: <span class="hljs-number">0.1</span>) { <span class="hljs-keyword">_</span> <span class="hljs-keyword">in</span><br />            <span class="hljs-type">XCTAssertEqual</span>(expectedMessage, assertionMessage)<br />            triggerFatalError <span class="hljs-operator">=</span> <span class="hljs-type">Swift</span>.fatalError<br />        }<br />    }<br />}</span></pre><p name="667c" id="667c" class="graf graf--p graf-after--pre">That’s a lot to unpack, which is a code smell already. Because you want things to be as simple as possible in test. Otherwise you need to test your test.</p><p name="d51c" id="d51c" class="graf graf--p graf-after--p">Comparing string message is very inefficient. He may want to provide readability, but string message is subject to change all the time; and it’s hard to avoid typo. It is too easy to break. Recall that ChatGPT used a <code class="markup--code markup--p-code">didTriggerFatalError: Bool</code> .</p><p name="678f" id="678f" class="graf graf--p graf-after--p">Note this:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="javascript" name="e76a" id="e76a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-title function_">waitForExpectations</span>(<span class="hljs-params">timeout: <span class="hljs-number">0.1</span></span>) { _ <span class="hljs-keyword">in</span><br />            <span class="hljs-title class_">XCTAssertEqual</span>(expectedMessage, assertionMessage)<br />            triggerFatalError = <span class="hljs-title class_">Swift</span>.<span class="hljs-property">fatalError</span><br />        }</span></pre><p name="32e9" id="32e9" class="graf graf--p graf-after--pre">Swizzling. He wants to revert back to default <code class="markup--code markup--p-code">fatalError</code> for no reason. Just use a custom function like <code class="markup--code markup--p-code">customError</code>so they are independent. It’s far, far, far simpler to have a function staying as it is without worrying about it changing at runtime. That’s why Swift, unlike Obj-C, has major emphasis on compile time check; that is why he promised <em class="markup--em markup--p-em">compile-time safety</em>.</p><blockquote name="21cd" id="21cd" class="graf graf--blockquote graf-after--p">The library in question is <a href="https://github.com/hmlongco/Factory" data-href="https://github.com/hmlongco/Factory" class="markup--anchor markup--blockquote-anchor" rel="noopener ugc nofollow noopener noopener" target="_blank">Factory</a>, <strong class="markup--strong markup--blockquote-strong">a compile-time safe</strong> dependency injection system, and a successor to Resolver.</blockquote><p name="91af" id="91af" class="graf graf--p graf-after--blockquote">Because by compile-time safe he actually meant “but runtime unsafe”. I also don’t think compile-time safe is what he thought it means either.</p><blockquote name="5192" id="5192" class="graf graf--blockquote graf-after--p">So the resolution code requires a factory, or it won’t compile. The closure must return the correct type. Or it won’t compile.</blockquote><p name="90a8" id="90a8" class="graf graf--p graf-after--blockquote">That sounds like just basic Swift compile time type checking. I may be wrong, but I though it is a runtime library, e.g.; you register at runtime (or at least some of them only occur at runtime); it resolves and checks circular dependency at runtime. He downplayed all the runtime components including swizzling just for one test!</p><p name="ae54" id="ae54" class="graf graf--p graf-after--p">Using closure is one thing. Mutating it is another. Mutating in async in test and reverting it back so other callers won’t notice is a completely different thing.</p><p name="6d5f" id="6d5f" class="graf graf--p graf-after--p">It may not harm as much if he used instance variables, so at least the risk is contained locally. He did not use singleton, right?</p><p name="4c44" id="4c44" class="graf graf--p graf-after--p">It looks like he did. Not 100% sure because I only look at code snippets. But he called <code class="markup--code markup--p-code">triggerFatalError</code> both in code and in test without other reference. But why would you expect a guy promoting “singleton management” to have any concern for singleton abuse?</p><p name="67fd" id="67fd" class="graf graf--p graf-after--p">Let me get this straight, this is a 100% test coverage library that promises compile-time safety, when its runtime behavior is not mentioned and the crash-prevention check is not shipped in release, while using singleton to couple code and test so it can do run-time swizzling when it’s absolutely not necessary and even ChatGPT knows it?</p><p name="f38e" id="f38e" class="graf graf--p graf-after--p">And this is a highlighted article on <em class="markup--em markup--p-em">better programming</em>? With claps, github stars, cooperate endorsements, and everything?</p><p name="78ea" id="78ea" class="graf graf--p graf-after--p">The ironic part is that he ended up using a custom closure, hinted by ChatGPT anyway.</p><p name="cbd5" id="cbd5" class="graf graf--p graf-after--p">Or better question yet, why should he give a shit about any of these when the first comment is:</p><figure name="502b" id="502b" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*ZrwjWK3YUQz4yn7AeBwjRA.png" data-width="506" data-height="78" src="https://cdn-images-1.medium.com/max/800/1*ZrwjWK3YUQz4yn7AeBwjRA.png"></figure><p name="d014" id="d014" class="graf graf--p graf-after--figure">Nice blog? Really? Where are these sheeps coming from? How to add colors is your main concern after all that??? Andrew? Is that you?</p><p name="b0b0" id="b0b0" class="graf graf--p graf-after--p">I’m gonna rapid-fire address his conclusions to save some time.</p><blockquote name="d670" id="d670" class="graf graf--blockquote graf-after--p">If you have sharp eyes you may have noticed<strong class="markup--strong markup--blockquote-strong"> a bit of extra code</strong> inside the screenshot that shows the <code class="markup--code markup--blockquote-code">triggerFatalError</code> message. Since the fatal error was <strong class="markup--strong markup--blockquote-strong">no longer a fatal error</strong>, a few Factory internals<strong class="markup--strong markup--blockquote-strong"> needed to be reset</strong> so that any test cases that ran after this one would start with a blank slate.</blockquote><blockquote name="0390" id="0390" class="graf graf--blockquote graf-after--blockquote">Completion Block</blockquote><blockquote name="f21b" id="f21b" class="graf graf--blockquote graf-after--blockquote">So that’s the <strong class="markup--strong markup--blockquote-strong">journey</strong>. It would be nice if <strong class="markup--strong markup--blockquote-strong">Apple built some sort of mechanism into Xcode to test such things</strong>, but then again, if they had I would have just done so and you probably wouldn’t be reading this article.</blockquote><blockquote name="cae6" id="cae6" class="graf graf--blockquote graf-after--blockquote">Hopefully, the trick presented here will help you on your own road to <strong class="markup--strong markup--blockquote-strong">100% code coverage</strong>. So <strong class="markup--strong markup--blockquote-strong">enjoy</strong>!</blockquote><p name="ecef" id="ecef" class="graf graf--p graf-after--blockquote">If you have sharper eyes, you may notice a bit of useless code. He had to downgrade fatal error like I said above. He shouldn’t have needed to reset anything. It’s not a journey, it’s an advertising campaign. Apple doesn’t need this built-in because it’s a customization you can carry out easily. 100% code coverage doesn’t mean shit, and I do not enjoy.</p><h4 name="b750" id="b750" class="graf graf--h4 graf-after--p">Judgment Day</h4><p name="487b" id="487b" class="graf graf--p graf-after--h4">If a top technical writer on this platform can be destroyed by Skynet, uh I mean ChatGPT, what hope is there?</p><p name="c7cf" id="c7cf" class="graf graf--p graf-after--p">From what I can tell, it can make average design decisions. That may not sound much, but remember half of the devs are below average.</p><p name="b897" id="b897" class="graf graf--p graf-after--p">Luckily ChatGPT hasn’t been able to seek out and destroy <em class="markup--em markup--p-em">better programming</em> like I did. Otherwise it’s judgement day.</p><p name="d5c9" id="d5c9" class="graf graf--p graf-after--p">As a wrap, I want to remark on the 100% code coverage. Do you think his check really detects all circular dependencies? From the looks of it, he is checking for duplicates in dependency chain, provided you register everything in dependency chain. What if you didn’t? Does that mean you have to inject everything from now on? What if there are legacy codes you can’t modify? And all that to prevent circular dependency? I don’t know about you, but I never had circular dependency problem. And the fact that DI encourages you to create dependencies might just be why you are having this problem in the first place.</p><p name="fdbe" id="fdbe" class="graf graf--p graf-after--p">If there may still circular dependencies at runtime, because you didn’t inject or register properly for example. 100% coverage doesn’t mean shit, especially when it is a runtime library which relies on user usage. Not to mention he may not even ship it! Oh, did I mention it didn’t prevent singleton abuse?</p><p name="e237" id="e237" class="graf graf--p graf-after--p">If I were to quickly determine a person’s capability, I’ll watch his test. A good test is incredibly hard. People boasting about 100% test coverage usually write dumb shit. Share this link I found while doing some research:</p><p name="bb58" id="bb58" class="graf graf--p graf-after--p"><a href="https://www.vadimbulavin.com/unit-testing-best-practices-on-ios-with-swift/" data-href="https://www.vadimbulavin.com/unit-testing-best-practices-on-ios-with-swift/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Unit testing best practices on iOS with Swift.</a></p><p name="8dc0" id="8dc0" class="graf graf--p graf-after--p">Some quick highlights:</p><blockquote name="2030" id="2030" class="graf graf--blockquote graf-after--p">Aim for 85% Code Coverage</blockquote><blockquote name="8b44" id="8b44" class="graf graf--blockquote graf-after--blockquote">Throwable Test Methods</blockquote><blockquote name="6d23" id="6d23" class="graf graf--blockquote graf-after--blockquote">Do Not Leak Test Code into Production</blockquote><p name="299a" id="299a" class="graf graf--p graf-after--blockquote">How would you rate it based on these 3? I’d say solid 0 out 3.</p><p name="ca80" id="ca80" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">The question is not if ChatGPT can replace developer. The question is have you been replaced? What does it take to not be replaced? Prepare for Judgement Day.</strong></p><p name="a356" id="a356" class="graf graf--p graf-after--p graf--trailing">(god damn it, I need to watch Terminator2 again lol)</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@swift2931" class="p-author h-card">Jim Lai</a> on <a href="https://medium.com/p/e1b36b83c12a"><time class="dt-published" datetime="2023-01-22T10:10:41.313Z">January 22, 2023</time></a>.</p><p><a href="https://medium.com/@swift2931/when-chatgpt-tried-to-save-you-e1b36b83c12a" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 9, 2023.</p></footer></article></body></html>