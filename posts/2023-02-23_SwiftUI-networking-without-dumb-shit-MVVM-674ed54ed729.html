<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>SwiftUI networking without dumb shit MVVM</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">SwiftUI networking without dumb shit MVVM</h1>
</header>
<section data-field="subtitle" class="p-summary">
It is incredibly hard
</section>
<section data-field="body" class="e-content">
<section name="51b9" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="d0d3" id="d0d3" class="graf graf--h3 graf--leading graf--title">SwiftUI networking without dumb shit MVVM</h3><p name="b529" id="b529" class="graf graf--p graf-after--h3">It is incredibly hard</p><figure name="1a30" id="1a30" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*sCyJRAEXbi3X96IgnC6l5Q.jpeg" data-width="944" data-height="499" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*sCyJRAEXbi3X96IgnC6l5Q.jpeg"></figure><p name="056a" id="056a" class="graf graf--p graf-after--figure">Saw this on recommended:</p><p name="a209" id="a209" class="graf graf--p graf-after--p"><a href="https://stevenpcurtis.medium.com/swiftui-mvvm-with-networking-fdc31000ffa" data-href="https://stevenpcurtis.medium.com/swiftui-mvvm-with-networking-fdc31000ffa" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">SwiftUI MVVM with Networking</a>, with a subtitle</p><blockquote name="5e63" id="5e63" class="graf graf--blockquote graf-after--p">It can’t be that hard!</blockquote><p name="927f" id="927f" class="graf graf--p graf-after--blockquote">And a difficulty setting as <strong class="markup--strong markup--p-strong">easy</strong>:</p><figure name="a9ee" id="a9ee" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*5Qs6hDP2gWmn9I2v4hOoWQ.png" data-width="593" data-height="72" src="https://cdn-images-1.medium.com/max/800/1*5Qs6hDP2gWmn9I2v4hOoWQ.png"></figure><p name="0fe3" id="0fe3" class="graf graf--p graf-after--figure">What I’m going to do here is to show you how easy to make dumb shit mistakes using MVVM, and how hard it is for MVVM devs to learn how to refactor a fetch.</p><p name="e347" id="e347" class="graf graf--p graf-after--p">I’ve covered a lot about dumb shit MVVM, so I’m going to focus more on protocol design and POP. You may check my previous articles if interested.</p><p name="a9d1" id="a9d1" class="graf graf--p graf-after--p">I’m going to start with an overview, then breaking down its problems. Then compare it with POP approach. Oh btw, I got blocked by this guy long time ago by commenting on his dumb shit design, so you may take this as a rant.</p><h4 name="efb2" id="efb2" class="graf graf--h4 graf-after--p">I would have picked you in the 9th round. No signing bonus.</h4><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="57d7" id="57d7" class="graf graf--pre graf-after--h4 graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ContentViewModel</span>: <span class="hljs-title class_">ObservableObject</span> {<br />    <span class="hljs-meta">@Published</span> <span class="hljs-keyword">var</span> users: [<span class="hljs-type">User</span>] <span class="hljs-operator">=</span> []<br />    <span class="hljs-keyword">var</span> res: <span class="hljs-type">AnyCancellable</span>?<br />    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> networkManager: <span class="hljs-type">AnyNetworkManager</span>&lt;<span class="hljs-type">URLSession</span>&gt;?<br />    <br />    <span class="hljs-keyword">init</span>() {<br />        <span class="hljs-keyword">self</span>.networkManager <span class="hljs-operator">=</span> <span class="hljs-type">AnyNetworkManager</span>(manager: <span class="hljs-type">NetworkManager</span>(session: <span class="hljs-type">URLSession</span>.shared))<br />        <br />        res <span class="hljs-operator">=</span> networkManager<span class="hljs-operator">?</span>.fetch(url: <span class="hljs-type">URL</span>(string: <span class="hljs-string">&quot;https://jsonplaceholder.typicode.com/posts/1&quot;</span>)<span class="hljs-operator">!</span>, method: .get)<br />            .sink(receiveCompletion: {comp <span class="hljs-keyword">in</span><br />                print (comp)},<br />                  receiveValue: {<br />                    val <span class="hljs-keyword">in</span><br />                    <span class="hljs-keyword">let</span> decode <span class="hljs-operator">=</span> <span class="hljs-type">JSONDecoder</span>()<br />                    <span class="hljs-keyword">let</span> decoded <span class="hljs-operator">=</span> <span class="hljs-keyword">try?</span> decode.decode(<span class="hljs-type">User</span>.<span class="hljs-keyword">self</span>, from: val)<br />                    <span class="hljs-keyword">self</span>.users <span class="hljs-operator">=</span> [decoded<span class="hljs-operator">!</span>]<br />            })<br />    }<br />}</span></pre><ol class="postList"><li name="0e55" id="0e55" class="graf graf--li graf-after--pre">Why <code class="markup--code markup--li-code">AnyNetworkManager</code> ?</li></ol><p name="41ef" id="41ef" class="graf graf--p graf-after--li">There’s no way you can implement a working<code class="markup--code markup--p-code">URLSession</code> . You can only mock one.</p><p name="a40b" id="a40b" class="graf graf--p graf-after--p">Is this the only way to mock network response? No.</p><p name="f3f9" id="f3f9" class="graf graf--p graf-after--p">Is this the best way? No.</p><p name="ac3d" id="ac3d" class="graf graf--p graf-after--p">For mocking, there could be multiple mock responses for <strong class="markup--strong markup--p-strong">EVERY </strong>endpoint depending on runtime configuration, so you want something <em class="markup--em markup--p-em">configurable</em>. e.g.; a variable or closure.</p><p name="e0fb" id="e0fb" class="graf graf--p graf-after--p">The “variable” he uses in this case is <code class="markup--code markup--p-code">urlSession</code> . This is too broad to be effective. To be more specific:</p><p name="ccd8" id="ccd8" class="graf graf--p graf-after--p">In production code, you have 0 reason to swap <code class="markup--code markup--p-code">urlSession</code> , so you look like an idiot passing a default <code class="markup--code markup--p-code">urlSession</code> in every <code class="markup--code markup--p-code">AnyNetworkManager</code> .</p><p name="c632" id="c632" class="graf graf--p graf-after--p">In test code, you either use 1 <code class="markup--code markup--p-code">mockURLSession</code> for all mocking, and inject it to every <code class="markup--code markup--p-code">AnyNetworkManager</code> instance like an idiot, and realize that you accidentally made them <code class="markup--code markup--p-code">private</code> like the “<strong class="markup--strong markup--p-strong">Easy</strong>” dude here, which makes you a bigger idiot; <strong class="markup--strong markup--p-strong">OR, you create a mock session CLASS for EVERY endpoint. </strong>This<strong class="markup--strong markup--p-strong"> </strong>is borderline brute force. No wait,<strong class="markup--strong markup--p-strong"> it is brute force</strong>.</p><p name="fd0f" id="fd0f" class="graf graf--p graf-after--p">2. Side effect in initializer</p><p name="4d80" id="4d80" class="graf graf--p graf-after--p">You can tell if a dev gives a shit about side effects from this. For outside caller, your object could be a black box, especially when your object is supposed to be used by someone else. Caller may not be ready to handle callback when he is in the middle of initializing, or may not be aware of that you call it for him, causing repeats.</p><p name="e714" id="e714" class="graf graf--p graf-after--p">3. Force unwrap</p><p name="9861" id="9861" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code">self.users = [decoded!]</code></p><p name="bb0c" id="bb0c" class="graf graf--p graf-after--p">Yeah, no way this decoding goes wrong. Why bother unwrapping at all? Swift should remove optional altogether.</p><p name="a550" id="a550" class="graf graf--p graf-after--p">4. Poor refactor</p><p name="d80f" id="d80f" class="graf graf--p graf-after--p">What if you want to change url endpoint? It is hard-coded in <code class="markup--code markup--p-code">init</code> .</p><p name="f592" id="f592" class="graf graf--p graf-after--p">What if you want to change model type, e.g.; <code class="markup--code markup--p-code">[User]</code> ? You have to rewrite the whole view model.</p><p name="8764" id="8764" class="graf graf--p graf-after--p">In fact, apart from endpoint and model type, this is basically a general fetch process. Yet none of these are reusable, namely, networking is coupled with view.</p><p name="fba0" id="fba0" class="graf graf--p graf-after--p">5. View model is dog shit in SwiftUI</p><p name="7b21" id="7b21" class="graf graf--p graf-after--p">Remove view model, and put <code class="markup--code markup--p-code">var users: [User] = []</code> as @State. Do you still have binding?</p><p name="a9c7" id="a9c7" class="graf graf--p graf-after--p">Of course, as you can easily verify. Changing @State triggers view updates. So you create a sink object just so you can write general fetch code coupled with view that cannot be reused.</p><p name="f77b" id="f77b" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Easy</strong>, right?</p><p name="4766" id="4766" class="graf graf--p graf-after--p">6. If you are going to have a default anyway, why fking use optional?</p><p name="b48d" id="b48d" class="graf graf--p graf-after--p">Instead of declaring optional then giving it default</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="5a07" id="5a07" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> networkManager: <span class="hljs-type">AnyNetworkManager</span>&lt;<span class="hljs-type">URLSession</span>&gt;?<br />    <br />    <span class="hljs-keyword">init</span>() {<br />        <span class="hljs-keyword">self</span>.networkManager <span class="hljs-operator">=</span> <span class="hljs-type">AnyNetworkManager</span>(manager: <span class="hljs-type">NetworkManager</span>(session: <span class="hljs-type">URLSession</span>.shared))<br />    <span class="hljs-operator">...</span><br /><span class="hljs-operator">...</span></span></pre><p name="f828" id="f828" class="graf graf--p graf-after--pre">You can declare it to be non-optional using default</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="13ae" id="13ae" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> networkManager <span class="hljs-operator">=</span> <span class="hljs-type">AnyNetworkManager</span>(manager: <span class="hljs-type">NetworkManager</span>(session: <span class="hljs-type">URLSession</span>.shared))</span></pre><p name="5990" id="5990" class="graf graf--p graf-after--pre">Why makes your life more difficult by introducing optional that you don’t need so you can force unwrap later?</p><p name="c84f" id="c84f" class="graf graf--p graf-after--p">He is writing as if someone can initialize it from outside when it is a <code class="markup--code markup--p-code">private</code> property.</p><p name="f547" id="f547" class="graf graf--p graf-after--p">The rest of his article is to implement <code class="markup--code markup--p-code">AnyNetworkManager</code> and <code class="markup--code markup--p-code">NetworkManager</code> , so he didn’t change this code structure. The question is then… why does he need two managers?</p><h4 name="7302" id="7302" class="graf graf--h4 graf-after--p">There is an epidemic failure within the game to understand what is really happening.</h4><blockquote name="00c1" id="00c1" class="graf graf--blockquote graf-after--h4">This is using a rather nifty network manager, which uses Type Erasure to wrap the <code class="markup--code markup--blockquote-code">Network Manager</code> which unfortunately<strong class="markup--strong markup--blockquote-strong"> has a associated type requirement</strong> which (if we want to store the Network Manager) means the owning class would need to be generic</blockquote><p name="70b0" id="70b0" class="graf graf--p graf-after--blockquote">I read this multiple times. I still fail to see why he needs an associated type.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="2bdc" id="2bdc" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">public</span> <span class="hljs-keyword">protocol</span> <span class="hljs-title class_">NetworkManagerProtocol</span> {<br />    <span class="hljs-keyword">associatedtype</span> aType<br />    <span class="hljs-keyword">var</span> session: aType { <span class="hljs-keyword">get</span> }<br /><br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-params">url</span>: <span class="hljs-type">URL</span>, <span class="hljs-params">method</span>: <span class="hljs-type">HTTPMethod</span>, <span class="hljs-params">headers</span>: [<span class="hljs-params">String</span> : <span class="hljs-type">String</span>], <span class="hljs-params">token</span>: <span class="hljs-type">String</span>?, <span class="hljs-params">data</span>: [<span class="hljs-params">String</span>: <span class="hljs-keyword">Any</span>]<span class="hljs-operator">?</span>) -&gt; <span class="hljs-type">AnyPublisher</span>&lt;<span class="hljs-type">Data</span>, <span class="hljs-type">NetworkError</span>&gt;<br />}<br /><br /><span class="hljs-keyword">extension</span> <span class="hljs-title class_">NetworkManagerProtocol</span> {<br />    <span class="hljs-keyword">public</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-params">url</span>: <span class="hljs-type">URL</span>, <span class="hljs-params">method</span>: <span class="hljs-type">HTTPMethod</span>, <span class="hljs-params">headers</span>: [<span class="hljs-params">String</span> : <span class="hljs-type">String</span>] <span class="hljs-operator">=</span> [:], <span class="hljs-params">token</span>: <span class="hljs-type">String</span>?, <span class="hljs-params">data</span>: [<span class="hljs-params">String</span>: <span class="hljs-keyword">Any</span>]<span class="hljs-operator">?</span>) -&gt; <span class="hljs-type">AnyPublisher</span>&lt;<span class="hljs-type">Data</span>, <span class="hljs-type">NetworkError</span>&gt; {<br />        <span class="hljs-keyword">return</span> fetch(url: url, method: method, headers: headers, token: token, data: data)<br />    }<br />}</span></pre><p name="3a9a" id="3a9a" class="graf graf--p graf-after--pre">The rule of thumb is that people who write <code class="markup--code markup--p-code">protocol XXXProtocol</code> writes the dumbest protocol. Why? Because whether something is a protocol or not can be easily inferred.</p><p name="d9d6" id="d9d6" class="graf graf--p graf-after--p">Note that he didn’t use <code class="markup--code markup--p-code">var session: aType</code> in protocol extension. That means this protocol is NOT self-contained. He also violated the convention that type should start with capital letter.</p><p name="fa1d" id="fa1d" class="graf graf--p graf-after--p">Take a closer look to extension, the two function signatures differ in a default parameter, namely <code class="markup--code markup--p-code">headers: [String : String] = [:]</code> .</p><p name="06a2" id="06a2" class="graf graf--p graf-after--p">So he is NOT actually providing default implementation to the function required by protocol. He is providing default implementation to a function NOT required by protocol, a wrapper.</p><p name="5211" id="5211" class="graf graf--p graf-after--p">This is dog shit protocol design. First it’s confusing. Second this wrapper is worthless. If anything this is a sign that you don’t need two managers since their functions are identical. Third, it’s not self-contained.</p><p name="0481" id="0481" class="graf graf--p graf-after--p">Another rule of thumb is that in POP you are not writing protocol to <em class="markup--em markup--p-em">require</em> something. You are writing to <em class="markup--em markup--p-em">provide</em> something. Mix-ins are self-contained codes that logically work. That is not to say you can’t use protocol in legacy OOP sense, provided that it makes sense.</p><p name="0991" id="0991" class="graf graf--p graf-after--p">Fouth, this protocol does not make sense.</p><figure name="fc6d" id="fc6d" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*utUxKBb-wvLUd8PkLQQ6Gg.png" data-width="666" data-height="624" src="https://cdn-images-1.medium.com/max/800/1*utUxKBb-wvLUd8PkLQQ6Gg.png"></figure><p name="8cac" id="8cac" class="graf graf--p graf-after--figure">Red box is our famililar SINGLETON, which defeats the whole purpose of passing type-erased <code class="markup--code markup--p-code">URLSessionProtocol</code> object!</p><p name="810e" id="810e" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code">session</code> is not even used!</p><p name="1a2b" id="1a2b" class="graf graf--p graf-after--p">The reasoning is wrong either. Conforming to generic protocol with associated type means you want to specify that type in type declaration. Then it’s fixed. What he wants is something he can specify during runtime, i.e.; generic protocol type &lt;T: P&gt;. He didn’t need generic protocol in the first place!</p><p name="92f4" id="92f4" class="graf graf--p graf-after--p">Look at this snippet:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="1ea5" id="1ea5" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AnyNetworkManager</span>&lt;<span class="hljs-title class_">U</span>: <span class="hljs-title class_">URLSessionProtocol</span>&gt;: <span class="hljs-title class_">NetworkManagerProtocol</span> {<br />    <span class="hljs-keyword">public</span> <span class="hljs-keyword">let</span> session: <span class="hljs-type">U</span><br />    <br />    <span class="hljs-keyword">let</span> fetchClosure: (<span class="hljs-type">URL</span>, <span class="hljs-type">HTTPMethod</span>, [String : <span class="hljs-type">String</span>], <span class="hljs-type">String</span>?, [String : <span class="hljs-keyword">Any</span>]<span class="hljs-operator">?</span>) -&gt; <span class="hljs-type">AnyPublisher</span>&lt;<span class="hljs-type">Data</span>, <span class="hljs-type">NetworkError</span>&gt;<br />    <br />    <span class="hljs-keyword">public</span> <span class="hljs-keyword">init</span>&lt;<span class="hljs-type">T</span>: <span class="hljs-type">NetworkManagerProtocol</span>&gt;(<span class="hljs-params">manager</span>: <span class="hljs-type">T</span>) {<br />        fetchClosure <span class="hljs-operator">=</span> manager.fetch<br />        session <span class="hljs-operator">=</span> manager.session <span class="hljs-keyword">as!</span> <span class="hljs-type">U</span><br />    }<br />        <br />    <span class="hljs-keyword">public</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-params">url</span>: <span class="hljs-type">URL</span>, <span class="hljs-params">method</span>: <span class="hljs-type">HTTPMethod</span>, <span class="hljs-params">headers</span>: [<span class="hljs-params">String</span> : <span class="hljs-type">String</span>] <span class="hljs-operator">=</span> [:], <span class="hljs-params">token</span>: <span class="hljs-type">String</span>? <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>, <span class="hljs-params">data</span>: [<span class="hljs-params">String</span>: <span class="hljs-keyword">Any</span>]<span class="hljs-operator">?</span> <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>) -&gt; <span class="hljs-type">AnyPublisher</span>&lt;<span class="hljs-type">Data</span>, <span class="hljs-type">NetworkError</span>&gt; {<br />        fetchClosure(url, method, headers, token, data)<br />    }<br />}</span></pre><p name="14d1" id="14d1" class="graf graf--p graf-after--pre">You don’t need associated type. You can do the same thing with just generic type <code class="markup--code markup--p-code">&lt;U: URLSessionProtocol&gt;</code> . He wants it both ways. He wants associated type <code class="markup--code markup--p-code">&lt;T: NetworkManagerProtocol&gt;</code> for some reason, then use generic type as associated type so he can have some kind of “runtime” associated type.</p><p name="54d3" id="54d3" class="graf graf--p graf-after--p">The problem is then, <code class="markup--code markup--p-code">T != U</code> . Why? I can have <code class="markup--code markup--p-code">class A: NetworkManagerProtocol</code> and <code class="markup--code markup--p-code">class B: NetworkManagerProtocol</code> , but <code class="markup--code markup--p-code">A != B</code> . And Swift compiler knows it!</p><p name="5cb4" id="5cb4" class="graf graf--p graf-after--p">This explains this epic fail</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="90ff" id="90ff" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">session <span class="hljs-operator">=</span> manager.session <span class="hljs-keyword">as!</span> <span class="hljs-type">U</span></span></pre><p name="cab9" id="cab9" class="graf graf--p graf-after--pre">Force unwrap. It sure is <strong class="markup--strong markup--p-strong">Easy</strong> when you can force unwrap any inconvenience.</p><p name="bbc5" id="bbc5" class="graf graf--p graf-after--p">Dog shit. Complete dog shit.</p><p name="b543" id="b543" class="graf graf--p graf-after--p">To be fair, this isn’t even about MVVM. But do you see how these devs hide behind the cover of MVVM and pump their dumb shit? What’s the title of that article? SwiftUI <strong class="markup--strong markup--p-strong">MVVM</strong> with Networking. And it’s <strong class="markup--strong markup--p-strong">Easy</strong>!</p><h4 name="5934" id="5934" class="graf graf--h4 graf-after--p">Do you want me to speak?</h4><figure name="8be3" id="8be3" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*ZcSfIBW27h3Z1olFbq3_Uw.jpeg" data-width="305" data-height="165" src="https://cdn-images-1.medium.com/max/800/1*ZcSfIBW27h3Z1olFbq3_Uw.jpeg"></figure><p name="7ddc" id="7ddc" class="graf graf--p graf-after--figure">It may be hard to believe, but MVVM has not figured out how to refactor <code class="markup--code markup--p-code">fetch </code>after half a decade since Swift was released.</p><p name="2e69" id="2e69" class="graf graf--p graf-after--p">Why is refactor important in POP? Because it’s built around <strong class="markup--strong markup--p-strong">refactoring out functions</strong>.</p><p name="00ad" id="00ad" class="graf graf--p graf-after--p">Not models, functions.</p><p name="22c2" id="22c2" class="graf graf--p graf-after--p">If you observe the above example, to do a <code class="markup--code markup--p-code">fetch</code> , he first created a <code class="markup--code markup--p-code">ViewModel</code> object to move model out. He then created two managers. That is 3 reference type objects. Then after tons of glue code, generics, associated type, initializers… he implemented <code class="markup--code markup--p-code">fetch</code> .</p><p name="197e" id="197e" class="graf graf--p graf-after--p">In POP, we start by refactoring out functions:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="15a1" id="15a1" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Fetcher</span> {<br />  <span class="hljs-keyword">func</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-operator">...</span>)<br />}</span></pre><p name="cfba" id="cfba" class="graf graf--p graf-after--pre">For this to be self-contained, we need an <code class="markup--code markup--p-code">URLSession</code> .</p><p name="4cea" id="4cea" class="graf graf--p graf-after--p">It can be a function parameter, or a property requirement. Then you can implement <code class="markup--code markup--p-code">fetch</code> as default implementation.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="f053" id="f053" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Fetcher</span> {<br />  <span class="hljs-keyword">var</span> session: <span class="hljs-type">URLSession</span> {<span class="hljs-keyword">get</span>}<br />  <span class="hljs-keyword">func</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-operator">...</span>)<br />} <br /><span class="hljs-keyword">extension</span> <span class="hljs-title class_">Fetch</span> {<br />  <span class="hljs-keyword">func</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-operator">...</span>) {<br />    session.dataTask(<span class="hljs-operator">...</span>)<br />  }<br />  <span class="hljs-keyword">var</span> session: <span class="hljs-type">URLSession</span> { <span class="hljs-type">URLSession</span>.shared }<br />}</span></pre><p name="94f0" id="94f0" class="graf graf--p graf-after--pre">Why self-contained is important? We only declare what we need for implementation. For example, we are not coupled with model type like <code class="markup--code markup--p-code">var users: [User]</code> . You start small, then gradually expand upon it, only adding things you need in implementation. You are refactoring out functions during the whole process without touching any objects.</p><p name="44b0" id="44b0" class="graf graf--p graf-after--p">Note that this is already equivalent to above example. I used singleton explicitly unlike he did in secret; I don’t have <code class="markup--code markup--p-code">NetworkManager</code> yet but his manager only does <code class="markup--code markup--p-code">fetch</code> so nothing is lost.</p><p name="4fa5" id="4fa5" class="graf graf--p graf-after--p">This is compact, single purpose, plug-and play functioning self-contained mix-in. And we do it without ever leaving the scope of protocol.</p><p name="ffc1" id="ffc1" class="graf graf--p graf-after--p">Do you see the difference?</p><blockquote name="e052" id="e052" class="graf graf--blockquote graf-after--p">No. No. Baseball thinking is medieval. They are asking all the wrong questions. And if I say it to anybody, I’m-I’m ostracized. I’m-I’m-I’m a leper. So that’s why I’m-I’m cagey about this with you. That’s why I… I respect you, Mr. Beane</blockquote><p name="0f54" id="0f54" class="graf graf--p graf-after--blockquote">MVVM thinking is medieval. They are asking all the wrong questions.</p><p name="51eb" id="51eb" class="graf graf--p graf-after--p">The real progress is outside MVVM.</p><h4 name="23ad" id="23ad" class="graf graf--h4 graf-after--p">Moneyball</h4><p name="0d62" id="0d62" class="graf graf--p graf-after--h4">I’m gonna quote his conclusion:</p><blockquote name="826d" id="826d" class="graf graf--blockquote graf-after--p">This is an interesting experiment that has led us to having a working network call from a view model.</blockquote><blockquote name="3fdf" id="3fdf" class="graf graf--blockquote graf-after--blockquote">Good stuff indeed!</blockquote><blockquote name="2846" id="2846" class="graf graf--blockquote graf-after--blockquote">Well done to all involved etc.</blockquote><p name="4448" id="4448" class="graf graf--p graf-after--blockquote">Anyone who is involved in this dumpster fire should be fired on spot.</p><p name="8c6b" id="8c6b" class="graf graf--p graf-after--p">This is the kind of MVVM echo chamber that produced dumb shit.</p><p name="f64d" id="f64d" class="graf graf--p graf-after--p">Do you know this guy have 25K followers? And after this dumpster fire he had the balls to ask</p><blockquote name="c21c" id="c21c" class="graf graf--blockquote graf-after--p">I know I have a large amount of articles, but some of these earn less than $1 dollar and without some support I find it difficult to justify time away from my family to create these tutorials (so any help is much appreciated).</blockquote><p name="cd27" id="cd27" class="graf graf--p graf-after--blockquote">That’s what it is all about. MVVM is moneyball. You pump it not because it’s good, but because it sells tutorials.</p><p name="23a2" id="23a2" class="graf graf--p graf-after--p">The POP steps I outlined are just first steps. You can then build network service, resource-based networking instead of request-based, … etc. And it will involve protocol composition and other techniques. At some point it needs to support JSON and mocking.</p><p name="2545" id="2545" class="graf graf--p graf-after--p">Sufficed to say, it is incredibly hard. Maybe I’ll go into more details some other time.</p><p name="59f6" id="59f6" class="graf graf--p graf-after--p">Let me conclude by quoting this:</p><blockquote name="78d7" id="78d7" class="graf graf--pullquote graf--startsWithDoubleQuote graf-after--p graf--trailing"><em class="markup--em markup--pullquote-em">“I’m a 44 year old guy with a high school diploma and a daughter I’d like to be able to send to college. You’re 25 years old with a degree from Yale and a pretty impressive apprenticeship. I don’t think we’re asking the right question. I think the question we should be asking is, do you believe in this thing (POP) or not?”</em></blockquote></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@swift2931" class="p-author h-card">Jim Lai</a> on <a href="https://medium.com/p/674ed54ed729"><time class="dt-published" datetime="2023-02-23T17:43:29.678Z">February 23, 2023</time></a>.</p><p><a href="https://medium.com/@swift2931/swiftui-networking-without-dumb-shit-mvvm-674ed54ed729" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 9, 2023.</p></footer></article></body></html>