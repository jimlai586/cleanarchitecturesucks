<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Man vs Clean Architecture Propaganda Machine</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Man vs Clean Architecture Propaganda Machine</h1>
</header>
<section data-field="subtitle" class="p-summary">
Your only weapon: refactor
</section>
<section data-field="body" class="e-content">
<section name="f2bf" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="fe15" id="fe15" class="graf graf--h3 graf--leading graf--title">Man vs Clean Architecture Propaganda Machine</h3><h4 name="5be3" id="5be3" class="graf graf--h4 graf-after--h3 graf--subtitle">Your only weapon: refactor</h4><figure name="0399" id="0399" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*5_zqIETU5baZLYKh3OZdpw.png" data-width="799" data-height="525" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*5_zqIETU5baZLYKh3OZdpw.png"><figcaption class="imageCaption">Can we defeat the propaganda machine?</figcaption></figure><h4 name="e470" id="e470" class="graf graf--h4 graf-after--figure">Clean Architecture 101</h4><p name="12ed" id="12ed" class="graf graf--p graf-after--h4">The above code snippet is obviously the (<em class="markup--em markup--p-em">in</em>)famous <strong class="markup--strong markup--p-strong">UseCase</strong> in clean architecture.</p><p name="773a" id="773a" class="graf graf--p graf-after--p">ChatGPT recognizes it immediately of course.</p><figure name="e70c" id="e70c" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*_NdkASYxOOMrXkUyHqDR5w.png" data-width="730" data-height="455" src="https://cdn-images-1.medium.com/max/800/1*_NdkASYxOOMrXkUyHqDR5w.png"></figure><p name="1c98" id="1c98" class="graf graf--p graf-after--figure">And proceed to spout a long list of “good practices” that we are all familiar with.</p><p name="9c41" id="9c41" class="graf graf--p graf-after--p">But what do you think ChatGPT really recognizes? All it has to base this on are <em class="markup--em markup--p-em">patterns</em>. There’s no context to my code snippet; I didn’t even specify UIKit or SwiftUI, or app structure in general.</p><p name="2982" id="2982" class="graf graf--p graf-after--p">The implication of this is that these building blocks are <em class="markup--em markup--p-em">fundamental</em>. They are <em class="markup--em markup--p-em">independent </em>of underlying language or SDK. They work the same for Java or Swift.</p><p name="e7ee" id="e7ee" class="graf graf--p graf-after--p">But is it?</p><p name="f845" id="f845" class="graf graf--p graf-after--p">Let’s explore this.</p><h4 name="ec2d" id="ec2d" class="graf graf--h4 graf-after--p">I didn’t learn shit at my day job</h4><p name="b102" id="b102" class="graf graf--p graf-after--h4">It always starts like this <a href="https://medium.com/@adha_fajri/clean-architecture-in-swiftui-b184e0e687f8" data-href="https://medium.com/@adha_fajri/clean-architecture-in-swiftui-b184e0e687f8" class="markup--anchor markup--p-anchor" target="_blank">SwiftUI Clean Architecture 101</a></p><blockquote name="2087" id="2087" class="graf graf--blockquote graf-after--p">I’ve always heard about “Clean Architecture” during <strong class="markup--strong markup--blockquote-strong">all the years I’ve been coding.</strong> However, I never bothered to learn or try it out due to ignorance or <strong class="markup--strong markup--blockquote-strong">thought it was unnecessary</strong>. Now that I have learned and tried it, I keep thinking, <strong class="markup--strong markup--blockquote-strong">“Why didn’t I learn about this sooner?”.</strong> <strong class="markup--strong markup--blockquote-strong">After realizing my mistake of skipping the most fundamental piece of coding knowledge on myself for all these years</strong>, I’ve decided to share my knowledge here so that people will avoid making the same mistake I did.</blockquote><p name="9103" id="9103" class="graf graf--p graf-after--blockquote">This piece of knowledge is so <em class="markup--em markup--p-em">fundamental</em>, that he NEVER needed in his day job during all the years he has been coding.</p><p name="6c0d" id="6c0d" class="graf graf--p graf-after--p">But after learning it, he became a mentor in guiding you towards being a world-class developer:</p><blockquote name="4f4a" id="4f4a" class="graf graf--blockquote graf-after--p">Congrats, you are now one step closer to being a <strong class="markup--strong markup--blockquote-strong">world-class developer</strong>! Hopefully, this article helps you understand the importance of clean architecture in your app and why it matters. Happy coding!</blockquote><p name="5e98" id="5e98" class="graf graf--p graf-after--blockquote">What magic is this? Something so fundamental that it transcends language, platform, even time? Whoever learns it is destined to be a world-class developer.</p><p name="9ddc" id="9ddc" class="graf graf--p graf-after--p">Either this “Bob” guy is an alias for J.R.R Tolkien, or there is some serious well-oiled propaganda machine working here.</p><p name="45b1" id="45b1" class="graf graf--p graf-after--p">I’m going to start with where he ends:</p><blockquote name="dbae" id="dbae" class="graf graf--pullquote graf--startsWithDoubleQuote graf-after--p"><em class="markup--em markup--pullquote-em">“Clean code always looks like it was written by someone who cares.” — Michael Feathers</em></blockquote><h4 name="18e8" id="18e8" class="graf graf--h4 graf-after--pullquote">Clean code always look like it was written by someone who doesn’t know how to refactor</h4><p name="bef0" id="bef0" class="graf graf--p graf-after--h4">We need to find a flaw in this machine. So I asked:</p><figure name="78da" id="78da" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*VEwUXJNaCrh2aR0w-QwWHw.png" data-width="838" data-height="324" src="https://cdn-images-1.medium.com/max/800/1*VEwUXJNaCrh2aR0w-QwWHw.png"></figure><p name="7e5d" id="7e5d" class="graf graf--p graf-after--figure">OK. Because there’s no context to conclude if this is inefficient or not. That is fair. Let’s provide some.</p><figure name="91fb" id="91fb" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*WRdalN9f40jkwQr7PG7CaA.png" data-width="835" data-height="820" src="https://cdn-images-1.medium.com/max/800/1*WRdalN9f40jkwQr7PG7CaA.png"></figure><p name="ad02" id="ad02" class="graf graf--p graf-after--figure">The surprising thing is that ChatGPT recognizes it!</p><p name="a2dc" id="a2dc" class="graf graf--p graf-after--p">Yeah, it is repetitive. And its suggestion is reasonable. Use generics.</p><p name="6bb5" id="6bb5" class="graf graf--p graf-after--p">Funny how our Clean-Arch-Mentor-Day-Job guy didn’t mention any of these. Isn’t this like <em class="markup--em markup--p-em">programming 101</em>?</p><p name="7c1d" id="7c1d" class="graf graf--p graf-after--p">Even ChatGPT, which was sprouting Clean Architecture propaganda two minutes ago, has to acknowledge it because logic dictates it. Well… at least until it goes back to sprouting more propaganda.</p><figure name="1ebf" id="1ebf" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*WUuIDlVaOq4wGieAT5v5zQ.png" data-width="875" data-height="541" src="https://cdn-images-1.medium.com/max/800/1*WUuIDlVaOq4wGieAT5v5zQ.png"></figure><p name="58b3" id="58b3" class="graf graf--p graf-after--figure">Why does this feel so fomulaic?</p><p name="ec6c" id="ec6c" class="graf graf--p graf-after--p">Because we are solving the same problem over and over again.</p><p name="c877" id="c877" class="graf graf--p graf-after--p">MVVM is supposed to make our codebase more modular, maintainable, and less exhausitive too, remember?</p><p name="35e9" id="35e9" class="graf graf--p graf-after--p">Then wait, interactor / coordinator can make it more modular, more decoupled.</p><p name="3373" id="3373" class="graf graf--p graf-after--p">But wait, this is where dependency injection came in to make it more modular, more decoupled.</p><p name="07ac" id="07ac" class="graf graf--p graf-after--p">Before you go, these <em class="markup--em markup--p-em">separation of concerns</em> among other abstract principles will definitely make it more modular this time.</p><p name="dae4" id="dae4" class="graf graf--p graf-after--p">Then we need more layers, more abstractions, to make it EVEN MORE modular, maintainable, testable… etc. Until we finally arrive at <strong class="markup--strong markup--p-strong">UseCases </strong>that are<strong class="markup--strong markup--p-strong"> EXHAUSTIVE AND REPETITIVE.</strong></p><p name="b06e" id="b06e" class="graf graf--p graf-after--p">What happened? How do we get here?</p><h4 name="7ac3" id="7ac3" class="graf graf--h4 graf-after--p">A house built from sand</h4><p name="4114" id="4114" class="graf graf--p graf-after--h4">According to <a href="https://blog.cleancoder.com/uncle-bob/2011/09/30/Screaming-Architecture.html" data-href="https://blog.cleancoder.com/uncle-bob/2011/09/30/Screaming-Architecture.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Bob</a>,</p><blockquote name="04da" id="04da" class="graf graf--blockquote graf-after--p">The Purpose of an Architecture</blockquote><blockquote name="b186" id="b186" class="graf graf--blockquote graf-after--blockquote">The reason that good architectures are centered around use-cases is so that architects can safely describe the structures that support those use-cases without committing to frameworks, tools, and environment. Again, consider the plans for a house. <strong class="markup--strong markup--blockquote-strong">The first concern of the architect is to make sure that the house is usable, it is not to ensure that the house is made of bricks.</strong> Indeed, the architect takes pains to ensure that the homeowner can decide about bricks, stone, or cedar <em class="markup--em markup--blockquote-em">later</em>, after the plans ensure that the use cases are met.</blockquote><p name="567f" id="567f" class="graf graf--p graf-after--blockquote">No. This is just plain wrong.</p><p name="ced3" id="ced3" class="graf graf--p graf-after--p">I don’t build a house, but even I know you need to consider building material when making safety calculations.</p><p name="245e" id="245e" class="graf graf--p graf-after--p">It made all the difference that your house is built from bricks or rebar-concrete.</p><p name="06c3" id="06c3" class="graf graf--p graf-after--p">What’s with this imagining your house in Metaverse built from hopes and dreams? You might want to add some rainbows and unicorns while you are at it.</p><p name="a726" id="a726" class="graf graf--p graf-after--p">How do you know if your house won’t collapse from its own weights if you didn’t know what it is made of? Let along <code class="markup--code markup--p-code">Usable</code> . <strong class="markup--strong markup--p-strong">What fking dumb shit</strong>.</p><p name="2f0b" id="2f0b" class="graf graf--p graf-after--p">Imagine architecturing your app because somebody on Internet says someone who clearly has no clue on how houses are built says we should build software like him building a house in some post taken out of context two decades ago.</p><p name="b3fe" id="b3fe" class="graf graf--p graf-after--p">In terms of actual, practical, real iOS production, normally we start with this:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="ruby" name="b183" id="b183" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-comment"># Next line contains target platform settings</span><br />platform <span class="hljs-symbol">:ios</span>, <span class="hljs-string">&#x27;8.0&#x27;</span><br /><span class="hljs-comment"># Use dynamic Frameworks</span><br />use_frameworks!<br /><br /><span class="hljs-comment"># Target name</span><br />target <span class="hljs-string">&#x27;MyApp&#x27;</span> <span class="hljs-keyword">do</span><br />  <span class="hljs-comment"># List of target dependencies</span><br />  pod <span class="hljs-string">&#x27;Alamofire&#x27;</span>, <span class="hljs-string">&#x27;~&gt; 4.0&#x27;</span><br /><span class="hljs-keyword">end</span></span></pre><p name="da94" id="da94" class="graf graf--p graf-after--pre">That is, we commited to a specific library, which is the brick in house analogy.</p><p name="ef35" id="ef35" class="graf graf--p graf-after--p">So what’s the point of pretending you don’t know what networking library you are going to use everywhere in your app? Like you are going to change bricks to concretes <em class="markup--em markup--p-em">after </em>the house is built?</p><p name="e0f9" id="e0f9" class="graf graf--p graf-after--p">There are cons to commiting to a specific library. Yes. As with every design decision. But that means there are benefits as well to justify it, such as that one can remove a runtime uncertainty and simplify design. The main objective is to select one libary that is the most code-efficient, NOT how we can swap it at runtime, because what’s the point of fking swapping it at runtime?</p><p name="2311" id="2311" class="graf graf--p graf-after--p">I don’t know who this “Michael” guy in above quote is. But this guy saw Bob’s nonsense house analogy, and went “it was written by someone who cares”. Let’s explore that too.</p><h4 name="e36b" id="e36b" class="graf graf--h4 graf-after--p">Someone who doesn’t give a shit</h4><p name="c3ea" id="c3ea" class="graf graf--p graf-after--h4">Let me quote it again to show respect.</p><blockquote name="1313" id="1313" class="graf graf--pullquote graf--startsWithDoubleQuote graf-after--p">“Clean code always looks like it was written by someone who cares.” — Michael Feathers</blockquote><p name="1a49" id="1a49" class="graf graf--p graf-after--pullquote">The question then, is this by someone who <strong class="markup--strong markup--p-strong">cares</strong>?</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="7aa7" id="7aa7" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PokeDexRepository</span>: <span class="hljs-title class_">PokeDexRepositoryProtocol</span> {<br />    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> shared <span class="hljs-operator">=</span> <span class="hljs-type">PokeDexRepository</span>()<br />    <br />    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> pokeDexDataSource <span class="hljs-operator">=</span> <span class="hljs-type">PokeDexDataSource</span>()<br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">fetchPokemons</span>(<span class="hljs-params">limit</span>: <span class="hljs-type">Int</span>, <span class="hljs-params">offset</span>: <span class="hljs-type">Int</span>) <span class="hljs-keyword">async</span> <span class="hljs-keyword">throws</span> -&gt; [<span class="hljs-type">PokemonEntity</span>] {<br />        <span class="hljs-keyword">let</span> pokemons <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> pokeDexDataSource.fetchPokemons(limit: limit, offset: offset)<br />        <span class="hljs-keyword">let</span> pokemonEntities: [<span class="hljs-type">PokemonEntity</span>] <span class="hljs-operator">=</span> pokemons.compactMap { pokemon <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">return</span> <span class="hljs-type">PokemonEntity</span>(pokemonResponse: pokemon)<br />        }<br />        <br />        <span class="hljs-keyword">return</span> pokemonEntities<br />    }<br />}</span></pre><p name="4145" id="4145" class="graf graf--p graf-after--pre">Let’s say we have another endpoint. <code class="markup--code markup--p-code">/sandhouse</code> .</p><p name="20bb" id="20bb" class="graf graf--p graf-after--p">I want to fetch and show some shit on a view.</p><p name="bce4" id="bce4" class="graf graf--p graf-after--p">Do I seriously have to fking create a <code class="markup--code markup--p-code">SandHouseRepository</code> followed by <code class="markup--code markup--p-code">SandHouseProtocol</code> , <code class="markup--code markup--p-code">SandHouseDataSource</code> , <code class="markup--code markup--p-code">SandHouseEntities</code> ?</p><p name="d117" id="d117" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">No it doesn’t say that you care. It says you don’t give a shit.</strong></p><p name="677f" id="677f" class="graf graf--p graf-after--p">Can ChatGPT tell you this? I’m afraid you have to be an expert in Robotics in Asimov fashion.</p><p name="222c" id="222c" class="graf graf--p graf-after--p">Can Google’s Clean Architecture guide tell you this? No. It’s the worst propaganda machine there ever is.</p><p name="06f9" id="06f9" class="graf graf--p graf-after--p">Can gurus and mentors on Clean Architecture tell you this? Of course not. They profited from this.</p><p name="a3d3" id="a3d3" class="graf graf--p graf-after--p">To be fair, Michael’s “clean code” may not refer to Clean Architecture. Then the question is still valid. Is this by someone who <strong class="markup--strong markup--p-strong">cares</strong>? Or because it has the word <em class="markup--em markup--p-em">clean</em> in it, it must be <em class="markup--em markup--p-em">clean</em>?</p><p name="22a8" id="22a8" class="graf graf--p graf-after--p">Now recall what ChatGPT suggests: <code class="markup--code markup--p-code">class GenericRepository&lt;T&gt;: RepositoryProtocol</code> .</p><p name="3503" id="3503" class="graf graf--p graf-after--p">A repository of a generic type gives little info. Even the protocol itself <code class="markup--code markup--p-code">RepositoryProtocol</code> is vague. It says nothing about what makes it special.</p><p name="9bcc" id="9bcc" class="graf graf--p graf-after--p">How about we emphasize on most iconic signature? E.g.; <code class="markup--code markup--p-code">fetch</code> .</p><p name="76f3" id="76f3" class="graf graf--p graf-after--p">Everyone knows what it does. What if we rename <code class="markup--code markup--p-code">GenericRepository&lt;T&gt;</code>to <code class="markup--code markup--p-code">NetworkService</code> with a temporary fixed type <code class="markup--code markup--p-code">fetchPokemons(...)</code> to simplify generics? The use case becomes</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="ad87" id="ad87" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">GetPokemonListUseCase</span> {<br />    <span class="hljs-keyword">let</span> network <span class="hljs-operator">=</span> <span class="hljs-type">NetworkService</span>()<br />    <span class="hljs-comment">/*<br />      let pokeDexRepository: PokeDexRepositoryProtocol<br />    <br />      init(pokeDexRepository: PokeDexRepositoryProtocol) {<br />          self.pokeDexRepository = pokeDexRepository<br />      }<br />    */</span><br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">limit</span>: <span class="hljs-type">Int</span>, <span class="hljs-params">offset</span>: <span class="hljs-type">Int</span>) <span class="hljs-keyword">async</span> <span class="hljs-keyword">throws</span> -&gt; [<span class="hljs-type">PokemonEntity</span>] {<br />        <span class="hljs-comment">// return try await pokeDexRepository.fetchPokemons(limit: limit, offset: offset)</span><br />        <span class="hljs-keyword">return</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> network.fetchPokemons(limit: limit, offset: offset)<br />    }<br />}</span></pre><p name="2544" id="2544" class="graf graf--p graf-after--pre">But then this is just a stupid wrapper of <code class="markup--code markup--p-code">network.fetchPokemons(...)</code></p><p name="2ff1" id="2ff1" class="graf graf--p graf-after--p">Say again Michael.</p><blockquote name="9d1d" id="9d1d" class="graf graf--pullquote graf--startsWithDoubleQuote graf-after--p">“Clean code always looks like it was written by someone who cares.” — Michael Feathers</blockquote><p name="dd8f" id="dd8f" class="graf graf--p graf-after--pullquote">Thank you Michael.</p><p name="3cbe" id="3cbe" class="graf graf--p graf-after--p">What happened here? What is the thing that actually needs generalization but he didn’t? It’s not <code class="markup--code markup--p-code">UseCase</code> , it’s not <code class="markup--code markup--p-code">Repository</code> , it’s function parameters in <code class="markup--code markup--p-code">fetchPokemons(limit: offset:)</code></p><p name="cceb" id="cceb" class="graf graf--p graf-after--p">This particular endpoint requires specific parameters, so you can’t just use standard <code class="markup--code markup--p-code">func fetch&lt;T&gt;() -&gt; T</code> . You can’t just pass in two integers either, because it usually requires end-point specific json body. You need something like <code class="markup--code markup--p-code">func fetch&lt;T&gt;(_ params: JSON) -&gt; T where T: Codable</code> to get out of being type-fixed. Otherwise, it just propagates through whatever many layers in your call stack.</p><p name="a698" id="a698" class="graf graf--p graf-after--p">Does Bob mention this while writing pseudo code in his non-building-material-specific imaginary house-building project in Metaverse?</p><p name="e6c2" id="e6c2" class="graf graf--p graf-after--p">As an exercise, since Swift is POP, how does this translate to protocol?</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="bcfa" id="bcfa" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">PokemonFetch</span> {<br />  <span class="hljs-keyword">var</span> network: <span class="hljs-type">NetworkService</span> {<span class="hljs-keyword">get</span>}<br />  <span class="hljs-keyword">var</span> params: <span class="hljs-type">JSON</span> {<span class="hljs-keyword">get</span>}<br />  <span class="hljs-keyword">func</span> <span class="hljs-title function_">getPokemonList</span>() <span class="hljs-keyword">async</span> -&gt; [<span class="hljs-type">Pokemon</span>]<br />  <span class="hljs-keyword">func</span> <span class="hljs-title function_">getPokemonDetail</span>() <span class="hljs-keyword">async</span> -&gt; <span class="hljs-type">PokemonDetail</span><br />}<br /><span class="hljs-keyword">extension</span> <span class="hljs-title class_">PokemonFetch</span> {<br />  <span class="hljs-keyword">var</span> params: <span class="hljs-type">JSON</span> {<br />    <span class="hljs-comment">// build your parameters</span><br />    <span class="hljs-comment">// whatever you need, declare it</span><br />  }<br />  <span class="hljs-keyword">func</span> <span class="hljs-title function_">getPokemonList</span>() <span class="hljs-keyword">async</span> -&gt; [<span class="hljs-type">Pokemon</span>] {<br />    <span class="hljs-comment">// you have enough to provide default impl. </span><br />  }<br />  <span class="hljs-comment">// ...</span><br />}<br /><br /></span></pre><p name="5e0c" id="5e0c" class="graf graf--p graf-after--pre">What’s the difference?</p><p name="4b33" id="4b33" class="graf graf--p graf-after--p">If you are going to pass in <code class="markup--code markup--p-code">NetworkService</code> in every use case, might as well <em class="markup--em markup--p-em">require </em>it.</p><p name="2d5e" id="2d5e" class="graf graf--p graf-after--p">If you are going to create protocol abstraction for every class, might as well work with protocols <em class="markup--em markup--p-em">only. </em>You<em class="markup--em markup--p-em"> </em>need class only to provide <em class="markup--em markup--p-em">shared </em>storage in final stage.</p><p name="9584" id="9584" class="graf graf--p graf-after--p">We maintain encapsulation. No time is spent initializing or passing shit. Protocol best comes self-contained, battery included. Only customizing, never rewriting the whole thing.</p><p name="252e" id="252e" class="graf graf--p graf-after--p">I don’t want to go into dumb shit dependency injection here, because you would lose focus. Let’s say if you want a list of properties used, it’s all in protocol <em class="markup--em markup--p-em">requirement</em>.</p><p name="ce8f" id="ce8f" class="graf graf--p graf-after--p">Oh btw, this is not <em class="markup--em markup--p-em">clean</em>. This is <em class="markup--em markup--p-em">basic</em>. It’s what, 7 years after Swift 1.0? Why are you still writing dummy protocols? Oh, and you can have more than 1 function in protocol. If you care more about actual code, rather than abstract principles, maybe you would have got it right by now.</p><p name="7564" id="7564" class="graf graf--p graf-after--p">The real irony is perhaps this. If you follow Clean Architecture, you wrote dumb shit like you didn’t care; but when you stop giving a shit, it is written like you care. You can even argue this POP version satisfies the imaginary benefits of Clean Architecture.</p><p name="3d62" id="3d62" class="graf graf--p graf-after--p">What do you think, Michael?</p><p name="ffe8" id="ffe8" class="graf graf--p graf-after--p">Oh I’m sorry, he is busy promoting Bob’s book for some reason.</p><p name="0b15" id="0b15" class="graf graf--p graf-after--p">Let’s wrap up by asking ChatGPT one last question.</p><h4 name="c94f" id="c94f" class="graf graf--h4 graf-after--p">What is this tight coupling?</h4><figure name="2c22" id="2c22" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*-6hKcLcrq3cI5KyMg122HQ.png" data-width="843" data-height="1014" src="https://cdn-images-1.medium.com/max/800/1*-6hKcLcrq3cI5KyMg122HQ.png"></figure><p name="df1d" id="df1d" class="graf graf--p graf-after--figure">And I quote:</p><blockquote name="d9bf" id="d9bf" class="graf graf--blockquote graf-after--p">If you have a use case that is<strong class="markup--strong markup--blockquote-strong"> tightly coupled to a specific data type, it may seem like it defeats the purpose of repository abstraction to some extent</strong>. However, there are scenarios where such specificity can still be beneficial:</blockquote><p name="b9e5" id="b9e5" class="graf graf--p graf-after--blockquote">In an architecture that is all about <strong class="markup--strong markup--p-strong">LOOSE COUPLING</strong>. No way!</p><p name="8a5e" id="8a5e" class="graf graf--p graf-after--p">Point 2 in particular seems like a direct contradiction to what it suggested earlier with <code class="markup--code markup--p-code">GenericRepository</code> , unless you reuse most of logic via inheritance.</p><p name="6f6b" id="6f6b" class="graf graf--p graf-after--p">This is for fun, of course. I’m sure you can twist ChatGPT’s arms to make it say whatever you want.</p><p name="a9d5" id="a9d5" class="graf graf--p graf-after--p">What I want to highlight is this:</p><blockquote name="445c" id="445c" class="graf graf--blockquote graf-after--p">you can explore more abstract and generic approaches to reduce redundancy</blockquote><p name="3123" id="3123" class="graf graf--p graf-after--blockquote">This is the key to NOT be replaced by ChatGPT.</p><p name="1c8d" id="1c8d" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">No. You can reduce redundancy by being specific.</strong></p><p name="37ad" id="37ad" class="graf graf--p graf-after--p">The key is, instead of inheritance, use protocol extension to refactor.</p><p name="277e" id="277e" class="graf graf--p graf-after--p">For exmaple, there are uniques thing that you have to handle with each endpoint; but in above case Clean Architecture failed because</p><p name="dc1f" id="dc1f" class="graf graf--p graf-after--p">a. it over-generalized in some areas</p><p name="59e9" id="59e9" class="graf graf--p graf-after--p">b. it didn’t generalize things that actually need it</p><p name="3876" id="3876" class="graf graf--p graf-after--p">c. doesn’t use inheritance or extension</p><p name="c740" id="c740" class="graf graf--p graf-after--p">As a result, type-specific coupling propagates out, which floods all areas.</p><p name="032d" id="032d" class="graf graf--p graf-after--p">I call this “because I use injection, I’m invincible” syndrome.</p><p name="1a39" id="1a39" class="graf graf--p graf-after--p">Compare to our protocol:</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="32f5" id="32f5" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">PokemonFetch</span> {<br />  <span class="hljs-keyword">var</span> network: <span class="hljs-type">NetworkService</span> {<span class="hljs-keyword">get</span>}<br />  <span class="hljs-keyword">var</span> params: <span class="hljs-type">JSON</span> {<span class="hljs-keyword">get</span>}<br />  <span class="hljs-keyword">func</span> <span class="hljs-title function_">getPokemonList</span>() <span class="hljs-keyword">async</span> -&gt; [<span class="hljs-type">Pokemon</span>]<br />  <span class="hljs-keyword">func</span> <span class="hljs-title function_">getPokemonDetail</span>() <span class="hljs-keyword">async</span> -&gt; <span class="hljs-type">PokemonDetail</span><br />}</span></pre><p name="edcd" id="edcd" class="graf graf--p graf-after--pre">This protocol has a prefix, but not tied to one model type. And this prefix does not pollute <code class="markup--code markup--p-code">NetworkService</code> .</p><p name="e2ba" id="e2ba" class="graf graf--p graf-after--p">The two fetch functions seem to duplicate fetch code, but instead of this times 2:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="029c" id="029c" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">    <span class="hljs-keyword">func</span> <span class="hljs-title function_">fetchPokemons</span>(<span class="hljs-params">limit</span>: <span class="hljs-type">Int</span>, <span class="hljs-params">offset</span>: <span class="hljs-type">Int</span>) <span class="hljs-keyword">async</span> <span class="hljs-keyword">throws</span> -&gt; [<span class="hljs-type">PokemonEntity</span>] {<br />        <span class="hljs-keyword">let</span> pokemons <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> pokeDexDataSource.fetchPokemons(limit: limit, offset: offset)<br />        <span class="hljs-keyword">let</span> pokemonEntities: [<span class="hljs-type">PokemonEntity</span>] <span class="hljs-operator">=</span> pokemons.compactMap { pokemon <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">return</span> <span class="hljs-type">PokemonEntity</span>(pokemonResponse: pokemon)<br />        }<br />        <br />        <span class="hljs-keyword">return</span> pokemonEntities<br />    }</span></pre><p name="6702" id="6702" class="graf graf--p graf-after--pre">We can write this:</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="3616" id="3616" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">getPokemonList</span>() <span class="hljs-keyword">async</span> -&gt; [<span class="hljs-type">Pokemon</span>] {<br />  <span class="hljs-keyword">let</span> pokemons: [<span class="hljs-type">Pokemon</span>] <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> network.fetch(url, params) <span class="hljs-comment">// generic type inference</span><br />  <span class="hljs-comment">// do your special shit with pokemons</span><br />}<br /><span class="hljs-keyword">func</span> <span class="hljs-title function_">getPokemonDetail</span>() <span class="hljs-keyword">async</span> -&gt; <span class="hljs-type">PokemonDetail</span> {<br />  <span class="hljs-keyword">let</span> detail: <span class="hljs-type">PokemonDetail</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> network.fetch(url, detailParams) <span class="hljs-comment">// generic type inference</span><br />  <span class="hljs-comment">// do your special shit with detail</span><br />}</span></pre><p name="b7eb" id="b7eb" class="graf graf--p graf-after--pre">If you don’t need to do special shit, then you don’t even need these two functions.</p><p name="14ae" id="14ae" class="graf graf--p graf-after--p">And guess what, we just remove two functions from protocol. No need to delete files, remove classes, protocols, modify injections… etc.</p><p name="77b9" id="77b9" class="graf graf--p graf-after--p">We try to refactor as much as possible while handling specfic responses to each endpoint. Can this be improved? YES!</p><p name="97c2" id="97c2" class="graf graf--p graf-after--p">What really brought down Clean Architecture in the end, is complacency.</p><p name="4cf6" id="4cf6" class="graf graf--p graf-after--p">I do more refactor work in a rant article than a tutorial 101.</p><p name="4d7c" id="4d7c" class="graf graf--p graf-after--p">Alright, I got to eat. Share one more funny thing before I go.</p><p name="d96a" id="d96a" class="graf graf--p graf-after--p">I’ve written enough articles under the tag “Clean Architecture” that I show up as a “contributor”, lol.</p><p name="62ad" id="62ad" class="graf graf--p graf-after--p">Imagine some guy trying to learn tutorial, and clicked into this.</p><figure name="63cd" id="63cd" class="graf graf--figure graf-after--p graf--trailing"><img class="graf-image" data-image-id="1*F4aPew7mP-1MV1_g1vSlNA.png" data-width="925" data-height="628" src="https://cdn-images-1.medium.com/max/800/1*F4aPew7mP-1MV1_g1vSlNA.png"></figure></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@swift2931" class="p-author h-card">Jim Lai</a> on <a href="https://medium.com/p/73da8c59f72f"><time class="dt-published" datetime="2023-09-08T10:36:37.142Z">September 8, 2023</time></a>.</p><p><a href="https://medium.com/@swift2931/man-vs-clean-architecture-propaganda-machine-73da8c59f72f" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 9, 2023.</p></footer></article></body></html>